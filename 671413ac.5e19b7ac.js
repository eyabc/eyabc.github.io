(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{230:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return s}));var r=n(3),a=n(7),c=(n(0),n(460)),o={},i={unversionedId:"nest-js/overview/interceptor",id:"nest-js/overview/interceptor",isDocsHomePage:!1,title:"interceptor",description:"https://docs.nestjs.com/interceptors",source:"@site/docs/nest-js/overview/interceptor.mdx",slug:"/nest-js/overview/interceptor",permalink:"/docs/nest-js/overview/interceptor",version:"current",sidebar:"nestJs",previous:{title:"guards",permalink:"/docs/nest-js/overview/guards"},next:{title:"custom-decorators",permalink:"/docs/nest-js/overview/custom-decorators"}},l=[{value:"Basics",id:"basics",children:[]},{value:"ExecutionContext",id:"executioncontext",children:[]},{value:"Call handler",id:"call-handler",children:[]},{value:"Aspect interception",id:"aspect-interception",children:[]},{value:"Binding interceptors",id:"binding-interceptors",children:[]},{value:"Response mapping",id:"response-mapping",children:[]},{value:"Exception mapping",id:"exception-mapping",children:[]},{value:"Stream overriding",id:"stream-overriding",children:[]},{value:"More Operators",id:"more-operators",children:[]}],p={toc:l};function s(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(c.b)("wrapper",Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(c.b)("p",null,Object(c.b)("a",{parentName:"p",href:"https://docs.nestjs.com/interceptors"},"https://docs.nestjs.com/interceptors")),Object(c.b)("p",null,Object(c.b)("img",{parentName:"p",src:"https://docs.nestjs.com/assets/Interceptors_1.png",alt:"interceptor"})),Object(c.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(c.b)("div",{parentName:"div",className:"admonition-heading"},Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",{parentName:"h5",className:"admonition-icon"},Object(c.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(c.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"interceptor \uc758 \uc870\uac74")),Object(c.b)("div",{parentName:"div",className:"admonition-content"},Object(c.b)("p",{parentName:"div"},"\ub2e4\uc74c \uc870\uac74\uc744 \ub9cc\uc871\ud558\ub294 \ud074\ub798\uc2a4\uc774\ub2e4."),Object(c.b)("ul",{parentName:"div"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"@Injectable()")," \ub85c \ub370\ucf54\ub808\uc774\ud130 \ub3fc\uc788\ub2e4."),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"NestInterceptor")," \uc778\ud130\ud398\uc774\uc2a4\ub97c \uad6c\ud604\ud55c\ub2e4.")))),Object(c.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(c.b)("div",{parentName:"div",className:"admonition-heading"},Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",{parentName:"h5",className:"admonition-icon"},Object(c.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(c.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Interceptors's AOP technique")),Object(c.b)("div",{parentName:"div",className:"admonition-content"},Object(c.b)("p",{parentName:"div"},"Interceptors \ub294 Aspect Oriented Programming \uc5d0 \uc601\uac10\uc744 \ubc1b\uc558\ub2e4."),Object(c.b)("ul",{parentName:"div"},Object(c.b)("li",{parentName:"ul"},"\uba54\uc11c\ub4dc \uc2e4\ud589 \uc804\ud6c4\ub85c \ucd94\uac00\uc801\uc778\ub85c\uc9c1\uc744 \ubc14\uc778\ub4dc \ud560 \uc218 \uc788\ub2e4."),Object(c.b)("li",{parentName:"ul"},"\ud568\uc218\ub85c\ubd80\ud130 \ubc18\ud658\ub41c \uacb0\uacfc\ub97c \ubcc0\ud615\ud560 \uc218 \uc788\ub2e4."),Object(c.b)("li",{parentName:"ul"},"\ud568\uc218\ub85c\ubd80\ud130 \ub358\uc838\uc9c4 \uc608\uc678\ub97c \ubcc0\ud615\ud560 \uc218 \uc788\ub2e4."),Object(c.b)("li",{parentName:"ul"},"\uae30\ubcf8 \ud568\uc218\uc758 \ud589\uc704\ub97c \ud655\uc7a5\ud560 \uc218 \uc788\ub2e4."),Object(c.b)("li",{parentName:"ul"},"\ud2b9\uc815 \uc870\uac74\uc5d0 \uc758\uc874\ud558\uace0 \uc788\ub294 \ud568\uc218\ub97c \uc644\uc804\ud788 override \ud560 \uc218 \uc788\ub2e4. (e.g., for caching purposes)")))),Object(c.b)("h2",{id:"basics"},"Basics"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"interceptor \ub294 ",Object(c.b)("inlineCode",{parentName:"li"},"intercept()")," \ub97c \uad6c\ud604\ud55c\ub2e4.")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-typescript"},"/**\n * Interface providing access to the response stream.\n *\n * @see [Interceptors](https://docs.nestjs.com/interceptors)\n *\n * @publicApi\n */\nexport interface CallHandler<T = any> {\n    /**\n     * Returns an `Observable` representing the response stream from the route\n     * handler.\n     */\n    handle(): Observable<T>;\n}\n/**\n * Interface describing implementation of an interceptor.\n *\n * @see [Interceptors](https://docs.nestjs.com/interceptors)\n *\n * @publicApi\n */\nexport interface NestInterceptor<T = any, R = any> {\n    /**\n     * \ucee4\uc2a4\ud140 Interceptor \uc758 implement \uc744 \uc704\ud55c \uba54\uc11c\ub4dc\n     *\n     * @param context an `ExecutionContext` object providing methods to access the\n     * route handler and class about to be invoked.\n     * @param next a reference to the `CallHandler`, which provides access to an\n     * `Observable` representing the response stream from the route handler.\n     */\n    intercept(context: ExecutionContext, next: CallHandler<T>): Observable<R> | Promise<Observable<R>>;\n}\n")),Object(c.b)("h2",{id:"executioncontext"},"ExecutionContext"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"ArgumentsHost \ub97c \ud655\uc7a5\ud558\uba70, \uc0c8\ub85c\uc6b4 \ud5ec\ud37c \uba54\uc11c\ub4dc\ub97c \uac00\uc9c4\ub2e4.",Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"\ud604\uc7ac \uc2e4\ud589 \ud504\ub85c\uc138\uc2a4\uc758 \uc138\ubd80\uc815\ubcf4\ub97c \uac00\uc9c4\ub2e4.",Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"Controller, Methods, Execution Contexts \uc5d0\uc11c \uad11\ubc94\uc704\ud558\uac8c \uc791\ub3d9\ud560\uc218 \uc788\ub294 generic \ud55c interceptors \ub97c \ub9cc\ub4e4 \uc218 \uc788\ub2e4.")))))),Object(c.b)("h2",{id:"call-handler"},"Call handler"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},Object(c.b)("inlineCode",{parentName:"p"},"CallHandler")," \uc778\ud130\ud398\uc774\uc2a4\ub294 ",Object(c.b)("inlineCode",{parentName:"p"},"handle()")," \uc744 \uad6c\ud604\ud55c\ub2e4."),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"handle()")," \ub294 Interceptor \uc5d0\uc11c \uc6d0\ud558\ub294 \uc2dc\uc810\uc5d0, Route Handler \uba54\uc11c\ub4dc\ub97c \ud638\ucd9c\ud560 \uc218 \uc788\uac8c \ud574\uc900\ub2e4."),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"handle()")," \uc744 \uad6c\ud604\ud558\uc9c0 \uc54a\uc73c\uba74, Route Handler \uba54\uc11c\ub4dc\ub294 \uc2e4\ud589\ub418\uc9c0 \uc54a\ub294\ub2e4."))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},Object(c.b)("inlineCode",{parentName:"p"},"intercept()")," \uba54\uc11c\ub4dc\ub294 \ud6a8\uc728\uc801\uc73c\ub85c Request/Response \uc2a4\ud2b8\ub9bc\uc744 \ub798\ud551\ud55c\ub2e4.")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\uadf8 \uacb0\uacfc, \ub9c8\uc9c0\ub9c9 route handler \uc758 \uc2e4\ud589 \uc804\ud6c4\uc5d0 \ucee4\uc2a4\ud140 \ub85c\uc9c1\uc744 \uad6c\ud604\ud560 \uc218 \uc788\ub2e4.")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},Object(c.b)("inlineCode",{parentName:"p"},"handle()")," \uc774 \ud638\ucd9c\ub418\uae30 \uc804\uc5d0 \uc2e4\ud589\ub418\ub294 ",Object(c.b)("inlineCode",{parentName:"p"},"interceptor()")," \uba54\uc11c\ub4dc\uc5d0, \ucf54\ub4dc\ub97c \uc791\uc131\ud560 \uc218 \uc788\ub2e4.")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},Object(c.b)("inlineCode",{parentName:"p"},"handle()")," \uba54\uc11c\ub4dc\ub294 ",Object(c.b)("inlineCode",{parentName:"p"},"Observable")," \uc744 \ubc18\ud658\ud558\uae30 \ub54c\ubb38\uc5d0, \uac15\ub825\ud55c ",Object(c.b)("inlineCode",{parentName:"p"},"RxJS")," \uc5f0\uc0b0\uc790\ub97c \uc774\uc6a9\ud558\uc5ec Response \ub97c \ucd94\uac00\uc801\uc73c\ub85c \uc870\uc791\ud560 \uc218 \uc788\ub2e4.")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"Aspect Oriented Programming \uae30\uc220\uc744 \uc0ac\uc6a9\ud558\uc790\uba74,"),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"Pointcut"),"  \u2192  Route Handler \uc758 \ud638\ucd9c(handle() \uc744 \ud638\ucd9c\ud558\ub294\uac83)"),Object(c.b)("li",{parentName:"ul"},"\ucd94\uac00\uc801\uc778 \ub85c\uc9c1\uc774 \uc0bd\uc785\ub418\ub294 \uc9c0\uc810\uc744 \uc758\ubbf8\ud55c\ub2e4."))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\uc608\ub97c\ub4e4\uc5b4, ",Object(c.b)("inlineCode",{parentName:"p"},"POST/cats")," \uc694\uccad\uc5d0\uc11c, CatsController \ucee8\ud2b8\ub864\ub7ec \ub0b4\ubd80\uc5d0 create() \ud578\ub4e4\ub7ec\ub97c \ubaa9\uc801\uc73c\ub85c \ud588\uc744 \ub54c,"),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"handle() \uc744 \ud638\ucd9c\ud558\uc9c0 \uc54a\ub294 interceptor \uac00 \ud638\ucd9c\ub418\uc5c8\uc744 \ub54c, create() \ub294 \uc2e4\ud589\ub418\uc9c0 \uc54a\ub294\ub2e4.")))),Object(c.b)("h2",{id:"aspect-interception"},"Aspect interception"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="logging.interceptor.ts :: storing user calls, asynchronously dispatching events or calculating a timestamp"',title:'"logging.interceptor.ts',"::":!0,storing:!0,user:!0,"calls,":!0,asynchronously:!0,dispatching:!0,events:!0,or:!0,calculating:!0,a:!0,'timestamp"':!0},"import { Injectable, NestInterceptor, ExecutionContext, CallHandler } from '@nestjs/common';\nimport { Observable } from 'rxjs';\nimport { tap } from 'rxjs/operators';\n\n@Injectable()\nexport class LoggingInterceptor implements NestInterceptor {\n  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {\n    console.log('Before...');\n    const now = Date.now();\n    return next\n      .handle()\n      .pipe( // rxjs\n        tap(() => console.log(`After... ${Date.now() - new}ms`));\n      );\n  }\n}\n")),Object(c.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(c.b)("div",{parentName:"div",className:"admonition-heading"},Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",{parentName:"h5",className:"admonition-icon"},Object(c.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(c.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),Object(c.b)("inlineCode",{parentName:"h5"},"NestInterceptor<T, R>"))),Object(c.b)("div",{parentName:"div",className:"admonition-content"},Object(c.b)("ul",{parentName:"div"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"T"),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"Observable<T>")," \uc758 \ud0c0\uc785,"),Object(c.b)("li",{parentName:"ul"},"response \uc2a4\ud2b8\ub9bc\uc744 \uc11c\ud3ec\ud2b8 \ud55c\ub2e4."))),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"R"),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"Observable<R>")," \uc5d0 \uc758\ud574 \ub798\ud551\ub41c \uac12\uc758 \ud0c0\uc785")))))),Object(c.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(c.b)("div",{parentName:"div",className:"admonition-heading"},Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",{parentName:"h5",className:"admonition-icon"},Object(c.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(c.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(c.b)("div",{parentName:"div",className:"admonition-content"},Object(c.b)("p",{parentName:"div"},"Interceptor \ub294"),Object(c.b)("ul",{parentName:"div"},Object(c.b)("li",{parentName:"ul"},"controllers, providers, guards \ub4f1\uacfc \uac19\uc774, \uc0dd\uc131\uc790\uc5d0\uc11c \uc8fc\uc785\ub420 \uc218 \uc788\ub2e4.")))),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"handle() \ub294 RxJS Observable \uc744 \ub9ac\ud134\ud55c\ub2e4"),Object(c.b)("li",{parentName:"ul"},"RxJS \uc73c\ub85c, stream \uc744 \uc870\uc791\ud560 \uc218 \uc788\ub294 \ub9ce\uc740 \uc5f0\uc0b0\uc790\ub97c \uac00\uc9c4\ub2e4."),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"tap()"),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"observable stream \uc774 \uc815\uc0c1\uc801\uc73c\ub85c \uc885\ub8cc\ub418\uac70\ub098, \uc608\uc678\uc801\uc73c\ub85c \uc885\ub8cc\ub420 \ub54c \uc775\uba85\ub85c\uae45\uc744 \ud638\ucd9c\ud55c\ub2e4."),Object(c.b)("li",{parentName:"ul"},"\uadf8\ub807\uc9c0 \uc54a\ub294 \uacbd\uc6b0\uc5d0\ub3c4 Response \uc0ac\uc774\ud074\uc5d0 \ubc29\ud574\ub418\uc9c0 \uc54a\ub294\ub2e4.")))),Object(c.b)("h2",{id:"binding-interceptors"},"Binding interceptors"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="cats.controllers.ts:: \ud504\ub808\uc784\uc6cc\ud06c\uc5d0\uac8c \ucd08\uae30\ud654\uc640 \uc0dd\uc131\uc790 \uc8fc\uc785\uc758 \ucc45\uc784\uc744 \ub118\uae34\ub2e4."',title:'"cats.controllers.ts::',"\ud504\ub808\uc784\uc6cc\ud06c\uc5d0\uac8c":!0,"\ucd08\uae30\ud654\uc640":!0,"\uc0dd\uc131\uc790":!0,"\uc8fc\uc785\uc758":!0,"\ucc45\uc784\uc744":!0,'\ub118\uae34\ub2e4."':!0},"@UseInterceptors(LoggingInterceptor)\nexport class CatsController {}\n")),Object(c.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(c.b)("div",{parentName:"div",className:"admonition-heading"},Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",{parentName:"h5",className:"admonition-icon"},Object(c.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(c.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"interceptor \uc758 scope")),Object(c.b)("div",{parentName:"div",className:"admonition-content"},Object(c.b)("ul",{parentName:"div"},Object(c.b)("li",{parentName:"ul"},"controller-scoped"),Object(c.b)("li",{parentName:"ul"},"method-scoped"),Object(c.b)("li",{parentName:"ul"},"global-scoped")))),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="cats.controller.ts"',title:'"cats.controller.ts"'},"@UseInterceptors(new LoggingInterceptor())\nexports class CatsContrller {}\n")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="\uc804\uc5ed Interceptor \ubc14\uc778\ub529::\ubaa8\ub4c8\ubc16\uc5d0 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc758\uc874\uc131\uc8fc\uc785\uc744 \ud560 \uc218 \uc5c6\ub2e4."',title:'"\uc804\uc5ed',Interceptor:!0,"\ubc14\uc778\ub529::\ubaa8\ub4c8\ubc16\uc5d0":!0,"\uc788\uae30":!0,"\ub54c\ubb38\uc5d0":!0,"\uc758\uc874\uc131\uc8fc\uc785\uc744":!0,"\ud560":!0,"\uc218":!0,'\uc5c6\ub2e4."':!0},"const app = await NestFactory.create(AppModule);\napp.useGlobalInterceptors(new LoggingInterceptor());\n")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="app.module.ts::\ubaa8\ub4c8\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc804\uc5ed Interceptor \uc0ac\uc6a9\ud558\uae30"',title:'"app.module.ts::\ubaa8\ub4c8\uc744',"\uc0ac\uc6a9\ud558\uc5ec":!0,"\uc804\uc5ed":!0,Interceptor:!0,'\uc0ac\uc6a9\ud558\uae30"':!0},"import { Module } from '@nestjs/common';\nimport { APP_INTERCEPTOR } from '@nestjs/core';\n\n// \uc120\uc5b8\ub418\ub294 \ubaa8\ub4c8\uc5d0 \uc0c1\uad00\uc5c6\uc774 Interceptor \ub294 \uc804\uc5ed\uc801\uc73c\ub85c \uc791\ub3d9\ud55c\ub2e4.\n@Module({\n  providers: [\n    {\n      provide: APP_INTERCEPTOR,\n      useClass: LoggingInterceptor,\n    },\n  ]\n})\nexport class AppModule {}\n")),Object(c.b)("h2",{id:"response-mapping"},"Response mapping"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"handle() \uc740 Observable \uc744 \ubc18\ud658\ud558\uace0, stream \uc5d0\ub294 route handler \uc5d0\uc11c \ubc18\ud658\ub41c \uac12\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\uc73c\ubbc0\ub85c,"),Object(c.b)("li",{parentName:"ul"},"RxJS \uc758 ",Object(c.b)("inlineCode",{parentName:"li"},"map()")," \uc5f0\uc0b0\uc790\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc27d\uac8c \ubcc0\uacbd\ud560 \uc218 \uc788\ub2e4.")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="transform.interceptor.ts"',title:'"transform.interceptor.ts"'},"import { Injectable, NestInterceptor, ExecutionContext, CallHandler } from '@nestjs/common';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nexport interface Response<T> {\n  data: T;\n}\n\n@Injectable()\nexport class TransformInterceptor<T> implements NestInterceptor<T, Response<T>> {\n  intercep(context: ExecutionContext, next: CallHandler): Observable<Response<T>> {\n    return next.handler().pipe(map(data => ({ data })));\n  }\n}\n\n/* response of Request\n{\n  \"data\": []\n}\n*/\n")),Object(c.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(c.b)("div",{parentName:"div",className:"admonition-heading"},Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",{parentName:"h5",className:"admonition-icon"},Object(c.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(c.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),Object(c.b)("div",{parentName:"div",className:"admonition-content"},Object(c.b)("p",{parentName:"div"},"async intercept(...) \ube44\ub3d9\uae30 \uba54\uc11c\ub4dc\ub85c \uc120\uc5b8\ud560 \uc218 \uc788\ub2e4."))),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-typescript",metastring:"title=\"transform each occurrence of a null value to an empty string ''\"",title:'"transform',each:!0,occurrence:!0,of:!0,a:!0,null:!0,value:!0,to:!0,an:!0,empty:!0,string:!0,"''\"":!0},"import { Injectable, NestInterceptor, ExceutionContext, Callhandler } from '@nestjs/common';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators'\n\n@Injectable()\nexport class ExcludeNullInterceptor implements NestInterceptor {\n  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {\n    return next\n      .handle()\n      .pipe(map(value => value === null ? '' : value ));\n  }\n}\n")),Object(c.b)("h2",{id:"exception-mapping"},"Exception mapping"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="errors.interceptor.ts :: RxJS\'s catchError() - override thrown exceptions"',title:'"errors.interceptor.ts',"::":!0,"RxJS's":!0,"catchError()":!0,"-":!0,override:!0,thrown:!0,'exceptions"':!0},"import {\n  Injectable,\n  NestInterceptor,\n  ExecutionContext,\n  BadGatewayException,\n  Callhandler,\n} from '@nestjs/common';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\n@Injectable()\nexport class ErrorsInterceptor implements NestInterceptor {\n  intercept(context: ExceutionContext, next: CallHandler): Observable<any> {\n    return next\n      .handle()\n      .pipe(\n        catchError(err => throwError(() => new BadgatewayException()))),\n      );\n  }\n}\n")),Object(c.b)("h2",{id:"stream-overriding"},"Stream overriding"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="cache.interceptor.ts"',title:'"cache.interceptor.ts"'},"import { Injectable, NestInterceptor, ExecutionContext, CallHandler } from '@nestjs/common';\nimport { Observable, of } from 'rxjs';\n\n@Injectable()\nexport class CacheInterceptor implements NestInterceptor {\n  interceptor(context: ExecutionContext, next: CallHandler): Observable<any> {\n    const isCached = true;\n    if (isCached) {\n      return of([]);  // return a new stream & route handler won't be called\n    }\n    return next.handle();\n  }\n}\n")),Object(c.b)("p",null,"\ud578\ub4e4\ub7ec\uc758 \ud638\ucd9c\uc744 \ub9c9\uace0 different Value \ub97c \ubc18\ud658\ud558\uace0 \uc2f6\uc740 \uacbd\uc6b0"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"\uc751\ub2f5\uc18d\ub3c4 \ud5a5\uc0c1\uc744 \uc704\ud55c cache \uad6c\ud604"),Object(c.b)("li",{parentName:"ul"},"\uc77c\ubc18\uc801\uc778 \ubc29\ubc95\uc73c\ub85c \uad6c\ud604\ud558\uace0 \uc2f6\ub2e4\uba74, ",Object(c.b)("inlineCode",{parentName:"li"},"Reflector")," \uc640 \ucee4\uc2a4\ud140 \ub370\ucf54\ub808\uc774\ud130\ub85c \uad6c\ud604\ud560 \uc218 \uc788\ub2e4.")),Object(c.b)("h2",{id:"more-operators"},"More Operators"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-typescript",metastring:'title="timeout.interceptor.ts :: handle timeouts on route requests"',title:'"timeout.interceptor.ts',"::":!0,handle:!0,timeouts:!0,on:!0,route:!0,'requests"':!0},"import { Injectable, NestInterceptor, ExecutionContext, CallHandler, RequestTimeoutException } from '@nestjs/common';\nimport { Observable, throwError, TimeoutError } from 'rxjs';\nimport { catchError, timeout } from 'rxjs/operators';\n\n@Injectable()\nexport class TimeoutInterceptor implements NestInterceptor {\n  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {\n    return next.handle().pipe(\n      timeout(5000),\n      catchError(err => {\n        if (err instanceof TimeoutError) {\n          return throwError(() => new RequestTimeoutException());\n        }\n        return throwError(() => err);\n      }),\n    );\n  }\n}\n")))}s.isMDXComponent=!0},460:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return u}));var r=n(0),a=n.n(r);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.a.createContext({}),s=function(e){var t=a.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},b=function(e){var t=s(e.components);return a.a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,c=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),b=s(n),d=r,u=b["".concat(o,".").concat(d)]||b[d]||m[d]||c;return n?a.a.createElement(u,i(i({ref:t},p),{},{components:n})):a.a.createElement(u,i({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var c=n.length,o=new Array(c);o[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var p=2;p<c;p++)o[p]=n[p];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);