<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mindfulness Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mindfulness Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Mindfulness" href="/opensearch.xml"><title data-react-helmet="true">Jooq Tricks | Mindfulness</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Jooq Tricks | Mindfulness"><meta data-react-helmet="true" name="description" content="3.11.9 버전으로 작성되었습니다."><meta data-react-helmet="true" property="og:description" content="3.11.9 버전으로 작성되었습니다."><meta data-react-helmet="true" property="og:url" content="https://eyabc.github.io/docs/java/jooq/jooq_tricks"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://YGAFWBIY5W-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://eyabc.github.io/docs/java/jooq/jooq_tricks"><link rel="stylesheet" href="/styles.3ada4974.css">
<link rel="preload" href="/styles.b715cea4.js" as="script">
<link rel="preload" href="/runtime~main.01bf3f2f.js" as="script">
<link rel="preload" href="/main.f85ec068.js" as="script">
<link rel="preload" href="/1.878c926c.js" as="script">
<link rel="preload" href="/3.052ff86c.js" as="script">
<link rel="preload" href="/1be78505.641b6934.js" as="script">
<link rel="preload" href="/412.ad32a78c.js" as="script">
<link rel="preload" href="/935f2afb.0a816309.js" as="script">
<link rel="preload" href="/409.2e79ec87.js" as="script">
<link rel="preload" href="/17896441.12f0be0b.js" as="script">
<link rel="preload" href="/3f987819.89f0bf38.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="두려워도 중요하다면 시도해봐야 하지 않겠는가" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="두려워도 중요하다면 시도해봐야 하지 않겠는가" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">두려워도 중요하다면 시도해봐야 하지 않겠는가</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" target="_self" href="/docs/javascript/javascript/index">JavaScript</a><ul class="dropdown__menu"><li><a class="dropdown__link" type="doc" docid="nest-js" target="_self" href="/docs/nest-js/index">Nest JS</a></li><li><a class="dropdown__link" type="doc" docid="dev-settings" target="_self" href="/docs/javascript/dev-settings/index">dev-settings</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" target="_self" href="/docs/java/index">Java</a><ul class="dropdown__menu"><li><a class="dropdown__link" type="doc" docid="effective-java" target="_self" href="/docs/java/effective-java">Effective Java</a></li><li><a class="dropdown__link" type="doc" docid="java-spring" target="_self" href="/docs/java/spring/index">Spring</a></li><li><a class="dropdown__link" type="doc" docid="java-etc" target="_self" href="/docs/java/etc/index">etc</a></li></ul></div><a class="navbar__item navbar__link" target="_self" href="/docs/css/index">CSS</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" target="_self" href="/docs/dev-etc/index">Dev etc</a><ul class="dropdown__menu"><li><a class="dropdown__link" type="doc" docid="HTML" target="_self" href="/docs/html/index">HTML</a></li><li><a class="dropdown__link" type="doc" docid="network" target="_self" href="/docs/network/HTTP_headers_Referer_보안이슈">Network</a></li><li><a class="dropdown__link" type="doc" docid="os" target="_self" href="/docs/os/index">OS</a></li></ul></div><a class="navbar__item navbar__link" target="_self" href="/docs/infra/index">Infra</a><a class="navbar__item navbar__link" docid="Database" target="_self" href="/docs/database/index">Database</a><a class="navbar__item navbar__link" target="_self" href="/docs/consultant/index">Consultant</a><a class="navbar__item navbar__link" target="_self" href="/blog">Blog</a><a class="navbar__item navbar__link" target="_self" href="/docs/study/dku-javascript">Study</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/eyabc/eyabc.github.io" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="두려워도 중요하다면 시도해봐야 하지 않겠는가" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="두려워도 중요하다면 시도해봐야 하지 않겠는가" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">두려워도 중요하다면 시도해봐야 하지 않겠는가</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" target="_self" href="/docs/javascript/javascript/index">JavaScript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" type="doc" docid="nest-js" target="_self" href="/docs/nest-js/index">Nest JS</a></li><li class="menu__list-item"><a class="menu__link" type="doc" docid="dev-settings" target="_self" href="/docs/javascript/dev-settings/index">dev-settings</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" target="_self" href="/docs/java/index">Java</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" type="doc" docid="effective-java" target="_self" href="/docs/java/effective-java">Effective Java</a></li><li class="menu__list-item"><a class="menu__link" type="doc" docid="java-spring" target="_self" href="/docs/java/spring/index">Spring</a></li><li class="menu__list-item"><a class="menu__link" type="doc" docid="java-etc" target="_self" href="/docs/java/etc/index">etc</a></li></ul></li><li class="menu__list-item"><a class="menu__link" target="_self" href="/docs/css/index">CSS</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" role="button" target="_self" href="/docs/dev-etc/index">Dev etc</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" type="doc" docid="HTML" target="_self" href="/docs/html/index">HTML</a></li><li class="menu__list-item"><a class="menu__link" type="doc" docid="network" target="_self" href="/docs/network/HTTP_headers_Referer_보안이슈">Network</a></li><li class="menu__list-item"><a class="menu__link" type="doc" docid="os" target="_self" href="/docs/os/index">OS</a></li></ul></li><li class="menu__list-item"><a class="menu__link" target="_self" href="/docs/infra/index">Infra</a></li><li class="menu__list-item"><a class="menu__link" docid="Database" target="_self" href="/docs/database/index">Database</a></li><li class="menu__list-item"><a class="menu__link" target="_self" href="/docs/consultant/index">Consultant</a></li><li class="menu__list-item"><a class="menu__link" target="_self" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/eyabc/eyabc.github.io" target="_self" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a class="menu__link" target="_self" href="/docs/study/dku-javascript">Study</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/java/index">java</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java/compareTo_equals">compareTo_equals</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Lombok</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/java/lombok/data">Lombok - @Data</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">자료구조</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/java/data_structure/Set">Set</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/java/data_structure/Map">Map</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">JOOQ</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/java/jooq/jooq_tricks">Jooq Tricks</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/java/transient_fields">transient fields 임시 필드</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java/public_suffix_list">Public Suffix List (PSL)</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java/JDBC">JDBC</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java/package_module">package_module</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/java/jacksonJSONLibrary">jacksonJSONLibrary</a></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_2AGf"><div class="docItemContainer_1tAC"><article><header><h1 class="docTitle_cWlf">Jooq Tricks</h1></header><div class="markdown"><p>3.11.9 버전으로 작성되었습니다.</p><ol><li>BaseRepository 추상 클래스를 공통으로 확장합니다.</li></ol><p>JPA 의 <code>findById</code> 처럼 사용할 수 없을까 고민하였습니다.</p><p>테스트코드에서,
BaseRepository 를 확장한 Repository Map 을 주입받아 가져온 다음, truncate 메서드를
실행시켜주기 위해 BaseRepository 를 생성하게 되었습니다.</p><p>테이블최적화를 위한 작업으로 테이블 이름이 변경되었을 경우, 코드의 많은 부분을 변경해 주었어야 했습니다.
제너릭 클래스를 <code>class BaseRepository&lt;T extends Table&gt;</code> 사용하여 추상 멤버 변수에 <code>public final T TABLE;</code>
을 선언하고, 확장하는 클래스에서 <code>public class TableDaoJooqImpl extends BaseRepository&lt;JTable, JTableRecord&gt;</code>
제너릭 타입만 변경해주어, 테이블 Migration 시, 코드 변경을 최소화 하는 방안으로 사용하고 있습니다.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Slf4j</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@AllArgsConstructor</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@RequiredArgsConstructor</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public abstract class BaseRepository&lt;T extends Table, R extends Record&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public final T TABLE;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  protected final DSLContext writeContext;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  protected final DSLContext readContext;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  // ...</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code> protected final DSLContext writeContext;</code>  <code>protected final DSLContext readContext</code> 은
데이터 소스를 Master 와 Slave 로 나뉘어져 사용할 경우, 구분하여 사용할 수 있습니다.
하나의 데이터소스만을 사용할 땐,
bean 의 Qualify 로 writeContext, readContext 모두 구현한 후 동일한 데이터소스 설정을 사용할 수 있습니다.
혹은 DSLContext 를 하나만 빈으로 등록하면 됩니다.</p><p>트랜잭션을 bean 을 구현해, readContext 이름으로 빈을 주입받아도, 설정한 트랜잭션 매니저로 Master 데이터 소스를 사용할 수도 있고,
반대로도 가능합니다.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Repository</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class TableDaoJooqImpl extends BaseRepository&lt;JTable, JTableRecord&gt;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    implements TableDao {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public TableDaoJooqImpl( DSLContext writeContext, DSLContext readContext) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        super(JTable.TABLE, writeContext, readContext);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><ol start="2"><li>BaseRepository 의 메서드는 확장하는 클래스는 중복적으로 작성되는 java code 를 줄였습니다.
매개변수와 반환 타입으로, Pojo 객체나, Jooq 객체를 사용하도록 합니다.
추상화 되어 있기 때문에 사용에 항상 주의해야 할 것 같습니다.
설명이 되어 있지 않은 예상되지 않는 동작이 발생할 수도 있기 때문에,
더 구체적인 주석이 필요할 것 같습니다.</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public abstract class BaseRepository&lt;T extends Table, R extends Record&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public final T TABLE;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  protected final DSLContext writeContext;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  protected final DSLContext readContext;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public void fetchSql(String sql) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    writeContext.fetch(sql);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public void deleteAll() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    writeContext.delete(TABLE).execute();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  // 쓰지말것! 반드시 테스트에서만 사용</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public void truncate() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    // writeContext.truncate(TABLE).execute();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @Deprecated</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public Result&lt;Record&gt; convertListToResult(List&lt;? extends Record&gt; list) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    Result&lt;Record&gt; fetch = readContext.selectFrom(TABLE)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .limit(0)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .fetch();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    fetch.addAll(list);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return fetch;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public &lt;E&gt; Result&lt;Record&gt; saveAll(List&lt;E&gt; list) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    List&lt;Record&gt; collect = list.stream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .map(this::save)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .collect(Collectors.toList());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return convertListToResult(collect);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @SuppressWarnings(&quot;unchecked&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public void insertOnDuplicateKeyUpdate(R record) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    writeContext.insertInto(TABLE)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .set(record)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .onDuplicateKeyUpdate()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .set(record)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .execute();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  //  pojo 의 null 인 값은 업데이트 되지 않게함. pojo 로 Insert, Update Delete 할 때 꼭 사용해야함.</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public R newRecordIncludeNonNull(Object pojo) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    R newRecord = (R) readContext.newRecord(TABLE, pojo);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    List&lt;Field&gt; fields = newRecord.fieldsRow().fieldStream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .map(r -&gt; TABLE.field(r.getName()))</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .collect(Collectors.toList());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    AtomicInteger i = new AtomicInteger(-1);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    newRecord.valuesRow().fieldStream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .forEach(a -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        i.addAndGet(1);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        if (Objects.equals(a.getName(), &quot;null&quot;)) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          newRecord.changed(fields.get(i.get()), false);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      });</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return newRecord;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public R newRecord(Object pojo) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return (R) readContext.newRecord(TABLE, pojo);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public &lt;POJO&gt; void insertOnDuplicateKeyUpdate(POJO pojo) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    R record = (R) writeContext.newRecord(TABLE, pojo);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    insertOnDuplicateKeyUpdate(record);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public &lt;POJO&gt; void insertOnDuplicateKeyUpdate(POJO pojo) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    R record = (R) writeContext.newRecord(TABLE, pojo);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    insertOnDuplicateKeyUpdate(record);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public InsertSetMoreStep&lt;?&gt; setInsertPrimaryKey(InsertSetStep&lt;?&gt; insertSetStep) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return (InsertSetMoreStep&lt;?&gt;) insertSetStep;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @Deprecated // 코드가 너무 복잡해짐</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public &lt;E&gt; Condition primaryCondition(E item) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    throw new AssertionError(&quot;override primaryCondition!&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @Deprecated</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public int update(R item) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return writeContext.update(TABLE)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .set(item)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .where(primaryCondition(item))</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .execute();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public void update(List&lt;R&gt; item) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    for (R r : item) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      update(r);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  /**</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   * @param item</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   * @param condition</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   * @return the number of updated records</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   */</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public int update(R item, Condition condition) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return writeContext.update(TABLE)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .set(item)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .where(condition)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .execute();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @Deprecated</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public &lt;E&gt; Optional&lt;Record&gt; getByPrimaryCondition(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    E item,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    List&lt;TableField&lt;?, ?&gt;&gt; selectors</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  ) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return readContext.select(selectors)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .from(TABLE)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .where(primaryCondition(item))</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .fetchOptional();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @Deprecated</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public Optional&lt;R&gt; getByPrimaryCondition(R item) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return readContext.selectFrom(TABLE)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .where(primaryCondition(item))</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .fetchOptional();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public List&lt;Field&lt;Object&gt;&gt; convertNamesToJooqFields(List&lt;String&gt; selectors) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return selectors.stream().map(DSL::field)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .collect(Collectors.toList());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  private SelectConditionStep&lt;Record&gt; addConditionToSelectStep(R record,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    SelectConditionStep&lt;Record&gt; where) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    List&lt;Object&gt; values = new ArrayList&lt;&gt;(record.map(r -&gt; r)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .intoMap()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .values());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    Row fieldsRow = record.fieldsRow();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    for (Object o : values) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      if (isNull(o)) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        continue;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      int index = values.indexOf(o);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      where = where.and(((Field&lt;Object&gt;) fieldsRow.field(index)).eq(o));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return where;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public SelectConditionStep&lt;Record&gt; findBySelectorAndPojo(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    List&lt;String&gt; selectors,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    Object pojo</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  ) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    List&lt;Field&lt;Object&gt;&gt; fields = convertNamesToJooqFields(selectors);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    SelectConditionStep&lt;Record&gt; where = readContext.select(fields).from(TABLE)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .where();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return addConditionToSelectStep(newRecordIncludeNonNull(pojo), where);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public SelectConditionStep&lt;Record&gt; findByPojo(Object pojo) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return addConditionToSelectStep(newRecordIncludeNonNull(pojo), readContext.selectFrom(TABLE).where());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  Map&lt;? extends Table&lt;?&gt;, List&lt;TableField&lt;?, ?&gt;&gt;&gt; selectorsTableMapper(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    List&lt;TableField&lt;?, ?&gt;&gt; selectors) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return selectors.stream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .collect(groupingBy(TableField::getTable));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  static Map&lt;Table, ? extends List&lt;? extends Field&lt;?&gt;&gt;&gt; selectorsFieldTableMapper(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    List&lt;? extends Field&lt;?&gt;&gt; selectors) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return selectors.stream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .collect(groupingBy(r -&gt; ((TableField) r).getTable()));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="예제"></a>예제<a class="hash-link" href="#예제" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fetchstring-sql"></a>fetch(String sql)<a class="hash-link" href="#fetchstring-sql" title="Direct link to heading">#</a></h4><p>sql 파일을 실행시킬 때 사용할 수 있습니다.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public void fetchSql(String sql) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  writeContext.fetch(sql);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Slf4j</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@RequiredArgsConstructor</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Service</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class TestDBService {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    private final ObjectMapper objectMapper;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    private final Map&lt;String, BaseRepository&gt; baseRepositories;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    @Transactional</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    public void init() throws IOException, SQLException {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        clear(new ArrayList&lt;&gt;(baseRepositories.values()));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        // readStub 는 sql 파일을 String 으로 읽어오는 메서드 입니다.</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        for (String sql : readStub(STUB_PATH + &quot;insert-common-db.sql&quot;).split(&quot;;&quot;)) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            baseRepositories.get(&quot;tableDao&quot;).fetchSql(sql);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="delete-or-truncate"></a>delete or truncate<a class="hash-link" href="#delete-or-truncate" title="Direct link to heading">#</a></h4><p>두 메서드는 반드시 테스트코드에서만 사용할 수 있게 하도록 주의해야 합니다.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public void deleteAll() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  writeContext.delete(TABLE).execute();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public void truncate() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  writeContext.truncate(TABLE).execute();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>BaseRepository 를 확장한 테이블들의 레코드를 모두 삭제합니다.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public void clear(List&lt;BaseRepository&gt; repositories) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    LinkedList&lt;BaseRepository&lt;?, ?&gt;&gt; q = new LinkedList(repositories);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    int count = 0;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    while (true) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        if (q.size() == 0 || count == 100) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            break;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        BaseRepository el = null;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        try {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            el = q.remove();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            el.deleteAll();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (DataAccessException e) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            q.offer(el);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (NoSuchElementException e) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            log.info(&quot;delete BaseRepository data finished! success&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            break;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } catch (Exception e) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            log.info(&quot;delete BaseRepository data error!&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            break;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        } finally {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            count++;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="convert-list-to-jooq-result-record"></a>convert List to Jooq Result Record<a class="hash-link" href="#convert-list-to-jooq-result-record" title="Direct link to heading">#</a></h4><p>어떠한 사정으로 List 를 Result 매개변수 메서드의 인자로 넘겨야 할 때 사용할 수 있습니다.
쓰지 않는 것이 좋을 것 같습니다. Mysql 을 사용하다가, 다른 스토리지를 사용해야 할 때 Jooq 객체를 사용할 수 없다면
코드 전반에 흩어진, jooq 객체를 input output 으로 주고받는 다면, 코드를 수습해야 할 일이 생긴다면 어떡해야 할까요
Pojo 객체로 주고 받는것이 이로울 것 같습니다.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Deprecated</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public Result&lt;Record&gt; convertListToResult(List&lt;? extends Record&gt; list) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  Result&lt;Record&gt; fetch = readContext.selectFrom(TABLE)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .limit(0)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .fetch();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  fetch.addAll(list);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return fetch;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>이 메서드의 장점이 하나 있습니다.
table1 과 table2 가 있을 때, 두 테이블의 컬럼 스키마가 매우 유사합니다.
table1 의 레코드를 table2 로 저장하는 것을 구현해야 할 때,
table1 의 jooq 레코드를 가져온 다음 <code>into(TABLE2)</code> 메서드를 사용하면 table2 객체로 변환이 용이하기 때문에
table2 에 저장하는 것이 간편합니다.
하지만 중간에 table1 레코드를 가져온 다음, jooq 메서드의 한계로 list 타입을 반드시 거쳐야만 한다면,
list 타입의 table1 요소를 table2 로 변환하는 것이 번거로울 수 있습니다.
이 때 convertListToResult 를 사용한다면 jooq 의 result 타입으로 사용할 수 있는 메서드 장점을 누릴 수 있기 때문에 편리할 수 있습니다.</p><p>번거롭더라도 Pojo 를 사용하면 더 좋을 것 같기 때문에 @Deprecated 하여, 코드를 정리할 예정입니다.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="save-한-결과를-리턴"></a>save 한 결과를 리턴<a class="hash-link" href="#save-한-결과를-리턴" title="Direct link to heading">#</a></h4><p><code>List&lt;E&gt;</code> 의 E 는 호출될 때 JTableRecord 타입 이며 Record 타입으로 반환 합니다.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public &lt;E&gt; Result&lt;Record&gt; saveAll(List&lt;E&gt; list) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  List&lt;Record&gt; collect = list.stream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .map(this::save)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .collect(Collectors.toList());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return convertListToResult(collect);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public void saveAll(List&lt;JTableRecord&gt; list) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    tableDao.saveAll(list);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public &lt;E&gt; Record save(E item) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  UpdatableRecord&lt;?&gt; record = (UpdatableRecord&lt;?&gt;) writeContext.newRecord(TABLE, item);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  record.store();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return record;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public JTableRecord insertNew() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    JTableRecord record  = new JTableRecord();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    record.setA(a);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    record.setB(b);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return save(record).into(TABLE);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="insertonduplicatekeyupdate"></a>insertOnDuplicateKeyUpdate<a class="hash-link" href="#insertonduplicatekeyupdate" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@SuppressWarnings(&quot;unchecked&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public void insertOnDuplicateKeyUpdate(R record) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  writeContext.insertInto(TABLE)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .set(record)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .onDuplicateKeyUpdate()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .set(record)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .execute();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public void insertOnDuplicateKeyUpdate(Object pojo) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  writeContext.insertInto(writeContext.newRecord(TABLE, pojo))</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .set(record)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .onDuplicateKeyUpdate()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .set(record)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .execute();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Override</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public void insertOnDuplicateKeyUpdate(TablePojo tablePojo) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    super.insertOnDuplicateKeyUpdate(writeContext.newRecord(TABLE, tablePojo));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pojo-객체를-jooq-객체를-대신하여-cud-수행하기-위한-메서드"></a>Pojo 객체를 Jooq 객체를 대신하여 CUD 수행하기 위한 메서드<a class="hash-link" href="#pojo-객체를-jooq-객체를-대신하여-cud-수행하기-위한-메서드" title="Direct link to heading">#</a></h4><p>Pojo 객체에 null 이 아닌 값들만 insert 하거나, update 하거나 delete 를 하기 위한 조건으로 지정하고 싶을 수 있습니다.
pojo 객체를 도메인 객체로 래핑하고, 래핑한 객체를 <code>new JTableRecord()</code> 하여 조건으로 사용한 값들의 setter 를 호출할 수도 있지만,
Pojo 객체를 그대로 사용하고 싶을수도 있습니다. 하지만 Pojo 객체를 newRecord 를 사용하여 변환할 경우, null 이지만
Table 스키마에 null 일 경우 기본값이 지정되어 있을 때, Pojo 객체에 null 으로 되어 있지만 default 값이 자동으로 세팅됩니다.
이럴 때 default 값이 조건으로 세팅되지 않기 위해 메서드를 만들었습니다.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public R newRecordIncludeNonNull(Object pojo) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  R newRecord = (R) readContext.newRecord(TABLE, pojo);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  List&lt;Field&gt; fields = newRecord.fieldsRow().fieldStream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .map(r -&gt; TABLE.field(r.getName()))</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .collect(Collectors.toList());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  AtomicInteger i = new AtomicInteger(-1);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  newRecord.valuesRow().fieldStream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .forEach(a -&gt; {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      i.addAndGet(1);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      if (Objects.equals(a.getName(), &quot;null&quot;)) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        newRecord.changed(fields.get(i.get()), false);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    });</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return newRecord;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public SelectConditionStep&lt;Record&gt; findBySelectorAndPojo(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  List&lt;String&gt; selectors,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  Object pojo</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  List&lt;Field&lt;Object&gt;&gt; fields = convertNamesToJooqFields(selectors);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  SelectConditionStep&lt;Record&gt; where = readContext.select(fields).from(TABLE)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .where();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return addConditionToSelectStep(newRecordIncludeNonNull(pojo), where);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Override</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public int[] batchUpdate(List&lt;TablePojo&gt; tablePojo) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return writeContext.batchUpdate(tablePojo.stream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .map(this::newRecordIncludeNonNull)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .collect(Collectors.toList())</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  ).execute();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pojo-를-jooq-레코드로-변환"></a>Pojo 를 jooq 레코드로 변환<a class="hash-link" href="#pojo-를-jooq-레코드로-변환" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public R newRecord(Object pojo) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return (R) readContext.newRecord(TABLE, pojo);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="select-할-컬럼을-jooq-필드가-아닌-string-으로-지정할-때"></a>select 할 컬럼을 Jooq 필드가 아닌 String 으로 지정할 때,<a class="hash-link" href="#select-할-컬럼을-jooq-필드가-아닌-string-으로-지정할-때" title="Direct link to heading">#</a></h4><p><code>List&lt;String&gt;</code> 에서 <code>convertNamesToJooqFields</code> 메서드를 사용하여 변환하면
fields 가 Jooq 의 TableField 가 아니기 때문에 제약이 있을 수 있습니다.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public List&lt;Field&lt;Object&gt;&gt; convertNamesToJooqFields(List&lt;String&gt; selectors) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return selectors.stream().map(DSL::field)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .collect(Collectors.toList());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public SelectConditionStep&lt;Record&gt; findBySelectorAndPojo(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  List&lt;String&gt; selectors,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  Object pojo</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  List&lt;Field&lt;Object&gt;&gt; fields = convertNamesToJooqFields(selectors);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  SelectConditionStep&lt;Record&gt; where = readContext.select(fields).from(TABLE)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .where();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return addConditionToSelectStep(newRecordIncludeNonNull(pojo), where);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="jooqrecord-로-condition-만들기"></a>JooqRecord 로 Condition 만들기<a class="hash-link" href="#jooqrecord-로-condition-만들기" title="Direct link to heading">#</a></h4><p><code>SelectConditionStep&lt;Record&gt; where</code> 를 받지 않고 Codition 을 반환해도 됩니다.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  private SelectConditionStep&lt;Record&gt; addConditionToSelectStep(R record,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    SelectConditionStep&lt;Record&gt; where) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    List&lt;Object&gt; values = new ArrayList&lt;&gt;(record.map(r -&gt; r)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .intoMap()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .values());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    Row fieldsRow = record.fieldsRow();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    for (Object o : values) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      if (isNull(o)) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        continue;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      int index = values.indexOf(o);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      where = where.and(((Field&lt;Object&gt;) fieldsRow.field(index)).eq(o));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return where;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public SelectConditionStep&lt;Record&gt; findByPojo(Object pojo) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return addConditionToSelectStep(newRecordIncludeNonNull(pojo), readContext.selectFrom(TABLE).where());</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="tablefield-에서-사용된-table-찾기"></a>TableField 에서 사용된 Table 찾기<a class="hash-link" href="#tablefield-에서-사용된-table-찾기" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Map&lt;? extends Table&lt;?&gt;, List&lt;TableField&lt;?, ?&gt;&gt;&gt; selectorsTableMapper(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  List&lt;TableField&lt;?, ?&gt;&gt; selectors) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return selectors.stream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .collect(groupingBy(TableField::getTable));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">static Map&lt;Table, ? extends List&lt;? extends Field&lt;?&gt;&gt;&gt; selectorsFieldTableMapper(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  List&lt;? extends Field&lt;?&gt;&gt; selectors) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  return selectors.stream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    .collect(groupingBy(r -&gt; ((TableField) r).getTable()));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="selector-join-on-condition-나누기"></a>selector, join on, condition 나누기<a class="hash-link" href="#selector-join-on-condition-나누기" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Builder</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@RequiredArgsConstructor</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@AllArgsConstructor</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class BaseSelectBuilder {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  private final Select query;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  private Condition condition = DSL.and();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  private List&lt;Field&gt; selectors;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  private Map&lt;Table, ? extends List&lt;? extends Field&gt;&gt; selectorsTableMapper;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  private Map&lt;String, TableImpl&gt; aliasMap = new WeakHashMap&lt;&gt;();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  private BiConsumer&lt;Query, Map&lt;Table, ? extends List&lt;? extends Field&gt;&gt;&gt; joiner;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public SelectConditionStep&lt;?&gt; compose() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    this.selectors = query.getSelect();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    this.selectorsTableMapper = selectorsFieldTableMapper();</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    if (!isNull(joiner)) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      joiner.accept(query, selectorsTableMapper);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return ((SelectJoinStep) query).where(condition);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public Map&lt;Table, ? extends List&lt;? extends Field&gt;&gt; selectorsFieldTableMapper() {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return selectors.stream()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .collect(groupingBy(r -&gt; ((TableField)r).getTable()));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">BaseSelectBuilder.builder()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          .query(readContext.select(Arrays.asList(</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            TABLE.ID,</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            TABLE2.VALUE</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          )).from(TABLE))</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          .condition(Condition Object)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          .joiner(TableDaoJooqImpl::joinBuilder)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            .build()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">              .compose()</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">                  .fetch()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public static void joinBuilder(Query query, Map&lt;Table, ? extends List&lt;? extends Field&gt;&gt; selectorsTableMapper) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  if (!isNull(selectorsTableMapper.get(TABLE2))) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    query = ((SelectJoinStep) query)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .join(TABLE2)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .on(TABLE.ID.eq(TABLE2.TABLE_ID));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="여러-테이블의-컬럼을-가지고-있는-record-를-pojo-객체로-바인딩하기"></a>여러 테이블의 컬럼을 가지고 있는 Record 를 Pojo 객체로 바인딩하기<a class="hash-link" href="#여러-테이블의-컬럼을-가지고-있는-record-를-pojo-객체로-바인딩하기" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-java codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Slf4j</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Builder</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@NoArgsConstructor</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@AllArgsConstructor</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@Getter</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class Table implements TablePojo {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  @Column(table = TABLE_NAME, name = &quot;id&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  private Integer id;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  private Table2 table2;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  //...</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public static ServicePage fromJooqRecord(Record record) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    JooqRecordMapper jooqRecordMapper = JooqRecordMapper.of(record);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    if (!jooqRecordMapper.hasTable(Table.TABLE_NAME)) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      throw new EmptyResultDataAccessException(1);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    Table table = record.into(TABLE).into(Table.class);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    if (jooqRecordMapper.hasTable(Table2.TABLE_NAME)) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      table.table2 = Table2.fromJooqRecord(record);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return table;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">```</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">```java</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">// Ambigous SQL Warning 를 해결하기 위함. jooq 3.11 version 에서는 해당 경고를 설정을 통해 없앨 수 없음. Info 로그 레벨에서는 무조건 발생</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">@RequiredArgsConstructor(staticName = &quot;of&quot;)</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">public class JooqRecordMapper {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  private final Map&lt;String, String&gt; jooqRecordMapper;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public static JooqRecordMapper of(Record record) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    Map&lt;String, String&gt; collect = Arrays.stream(record.fields())</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .map(a -&gt; a.getQualifiedName().getName()[0])</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      .collect(Collectors.toSet())</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        .stream().collect(Collectors.toMap(e -&gt; e, e -&gt; e));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return JooqRecordMapper.of(collect);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  public boolean hasTable(String tableName) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    return !isNull(jooqRecordMapper.get(tableName.toLowerCase()));</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">}</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">```</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/java/data_structure/Map"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Map</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/java/transient_fields"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">transient fields 임시 필드 »</div></a></div></nav></div></div><div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#예제" class="table-of-contents__link">예제</a></li><li><a href="#selector-join-on-condition-나누기" class="table-of-contents__link">selector, join on, condition 나누기</a></li><li><a href="#여러-테이블의-컬럼을-가지고-있는-record-를-pojo-객체로-바인딩하기" class="table-of-contents__link">여러 테이블의 컬럼을 가지고 있는 Record 를 Pojo 객체로 바인딩하기</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/doc2">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_31Aa"><img class="footer__logo" alt="Facebook Open Source Logo" src="/img/oss_logo.png"></a></div><div class="footer__copyright">Copyright © 2022 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.b715cea4.js"></script>
<script src="/runtime~main.01bf3f2f.js"></script>
<script src="/main.f85ec068.js"></script>
<script src="/1.878c926c.js"></script>
<script src="/3.052ff86c.js"></script>
<script src="/1be78505.641b6934.js"></script>
<script src="/412.ad32a78c.js"></script>
<script src="/935f2afb.0a816309.js"></script>
<script src="/409.2e79ec87.js"></script>
<script src="/17896441.12f0be0b.js"></script>
<script src="/3f987819.89f0bf38.js"></script>
</body>
</html>