(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{185:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return o})),t.d(n,"toc",(function(){return l})),t.d(n,"default",(function(){return d}));var r=t(3),s=t(7),i=(t(0),t(470)),a={title:"5. \ucf54\ub4dc \uac1c\uc120"},o={unversionedId:"javascript/OOP/OOP_5",id:"javascript/OOP/OOP_5",isDocsHomePage:!1,title:"5. \ucf54\ub4dc \uac1c\uc120",description:"Reference",source:"@site/docs/javascript/OOP/OOP_5.md",slug:"/javascript/OOP/OOP_5",permalink:"/docs/javascript/OOP/OOP_5",version:"current",lastUpdatedAt:1626882853,sidebar:"javascript",previous:{title:"\uc124\uacc4 \uc885\ud569",permalink:"/docs/javascript/OOP/OOP_4"},next:{title:"window.opener",permalink:"/docs/javascript/browser/window-opener"}},l=[{value:"Reference",id:"reference",children:[]},{value:"1. \uae30\uc874 Binder \uc758 viewmodelUpdated \uc758 \ubb38\uc81c",id:"1-\uae30\uc874-binder-\uc758-viewmodelupdated-\uc758-\ubb38\uc81c",children:[]},{value:"2. Processor \uac1c\uc120",id:"2-processor-\uac1c\uc120",children:[]},{value:"3. List \ud45c\ud604\ud558\uae30",id:"3-list-\ud45c\ud604\ud558\uae30",children:[]}],c={toc:l};function d(e){var n=e.components,t=Object(s.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},c,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"reference"},"Reference"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://junilhwang.github.io/TIL/CodeSpitz/Object-Oriented-Javascript/05-Extension/#viewmodellistener-%E1%84%80%E1%85%A2%E1%84%89%E1%85%A5%E1%86%AB"},"https://junilhwang.github.io/TIL/CodeSpitz/Object-Oriented-Javascript/05-Extension/#viewmodellistener-%E1%84%80%E1%85%A2%E1%84%89%E1%85%A5%E1%86%AB"))),Object(i.b)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/5UUISCK6CL4",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0}),Object(i.b)("p",null,"\uae30\uc874\ubb38\uc81c\ub97c \ud558\ub098\uc529 \uc9da\uc5b4\ubcf4\ub3c4\ub85d \ud55c\ub2e4."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://gist.github.com/hikaMaeng/b7f0bed1cb1cce42373e810a77454f0f"},"code 3.js"))),Object(i.b)("details",null,Object(i.b)("summary",null,"html"),Object(i.b)("p",null,Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>Title</title>\n</head>\n<body>\n<section id="target" data-viewmodel="wrapper">\n    <h2 data-viewmodel="title"></h2>\n    <section data-viewmodel="contents"></section>\n    <ol data-viewmodel="list">\n        <li data-template="listItem" data-viewmodel="item"></li>\n    </ol>\n</section>\n<script src="3.js"><\/script>\n</body>\n</html>\n')))," "),Object(i.b)("details",null,Object(i.b)("summary",null,"\uc804\uccb4\ucf54\ub4dc"),Object(i.b)("p",null,Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"const type = (target, type) => {\n  if (typeof type == 'string') {\n    if (typeof target != type) throw `invaild type ${target} : ${type}`;\n  } else if (!(target instanceof type)) throw `invaild type ${target} : ${type}`;\n  return target;\n};\n\nconst ViewModelListener = class {\n  viewmodelUpdated(updated) {\n    throw 'override';\n  }\n};\n\nconst ViewModelValue = class {\n  subKey;\n  cat;\n  k;\n  v;\n\n  constructor(subKey, cat, k, v) {\n    this.subKey = subKey;\n    this.cat = cat;\n    this.k = k;\n    this.v = v;\n    Object.freeze(this);\n  }\n};\n\nconst ViewModel = class extends ViewModelListener {\n  static get(data) {\n    return new ViewModel(data);\n  }\n\n  static #subjects = new Set;\n  static #inited = false;\n\n  static notify(vm) {\n    this.#subjects.add(vm);\n    if (this.#inited) return;\n    this.#inited = true;\n    const f = _ => {\n      this.#subjects.forEach(vm => {\n        if (vm.#isUpdated.size) {\n          vm.notify();\n          vm.#isUpdated.clear();\n        }\n      });\n      requestAnimationFrame(f);\n    };\n    requestAnimationFrame(f);\n  }\n\n  static define(vm, cat, obj) {\n    return Object.defineProperties(obj, Object.entries(obj).reduce((r, [k, v]) => {\n      r[k] = {\n        enumerable: true,\n        get: _ => v,\n        set: newV => {\n          v = newV;\n          vm.#isUpdated.add(new ViewModelValue(vm.subKey, cat, k, v));\n        },\n      };\n      return r;\n    }, {}));\n  }\n\n  styles = {};\n  attributes = {};\n  properties = {};\n  events = {};\n  subKey = '';\n  parent = null;\n  #isUpdated = new Set;\n  #listeners = new Set;\n\n  constructor(data, _ = type(data, 'object')) {\n    super();\n    Object.entries(data).forEach(([k, v]) => {\n      if ('styles,attributes,properties'.includes(k)) {\n        if (!v || typeof v != 'object') throw `invalid object k:${k}, v:${v}`;\n        this[k] = ViewModel.define(this, k, v);\n      } else {\n        Object.defineProperty(this, k, {\n          enumerable: true,\n          get: _ => v,\n          set: newV => {\n            v = newV;\n            this.#isUpdated.add(new ViewModelValue(this.subKey, '', k, v));\n          },\n        });\n        if (v instanceof ViewModel) {\n          v.parent = this;\n          v.subKey = k;\n          v.addListener(this);\n        }\n      }\n    });\n    ViewModel.notify(this);\n    Object.seal(this);\n  }\n\n  viewmodelUpdated(updated) {\n    updated.forEach(v => this.#isUpdated.add(v));\n  }\n\n  addListener(v, _ = type(v, ViewModelListener)) {\n    this.#listeners.add(v);\n  }\n\n  removeListener(v, _ = type(v, ViewModelListener)) {\n    this.#listeners.delete(v);\n  }\n\n  notify() {\n    this.#listeners.forEach(v => v.viewmodelUpdated(this.#isUpdated));\n  }\n};\nconst Scanner = class {\n  scan(el, _ = type(el, HTMLElement)) {\n    const binder = new Binder;\n    this.checkItem(binder, el);\n    const stack = [el.firstElementChild];\n    let target;\n    while (target = stack.pop()) {\n      this.checkItem(binder, target);\n      if (target.firstElementChild) stack.push(target.firstElementChild);\n      if (target.nextElementSibling) stack.push(target.nextElementSibling);\n    }\n    return binder;\n  }\n\n  checkItem(binder, el) {\n    const vm = el.getAttribute('data-viewmodel');\n    if (vm) binder.add(new BinderItem(el, vm));\n  }\n};\nconst Processor = class {\n  cat;\n\n  constructor(cat) {\n    this.cat = cat;\n    Object.freeze(this);\n  }\n\n  process(vm, el, k, v, _0 = type(vm, ViewModel), _1 = type(el, HTMLElement), _2 = type(k, 'string')) {\n    this._process(vm, el, k, v);\n  }\n\n  _process(vm, el, k, v) {\n    throw 'override';\n  }\n};\n\nconst Binder = class extends ViewModelListener {\n  #items = new Set;\n  #processors = {};\n\n  add(v, _ = type(v, BinderItem)) {\n    this.#items.add(v);\n  }\n\n  viewmodelUpdated(updated) {\n    const items = {};\n    this.#items.forEach(item => {\n      items[item.viewmodel] = [\n        type(viewmodel[item.viewmodel], ViewModel),\n        item.el,\n      ];\n    });\n    updated.forEach(v => {\n      if (!items[v.subKey]) return;\n      const [vm, el] = items[v.subKey], processor = this.#processors[v.cat];\n      if (!el || !processor) return;\n      processor.process(vm, el, v.k, v.v);\n    });\n  }\n\n  addProcessor(v, _0 = type(v, Processor)) {\n    this.#processors[v.cat] = v;\n  }\n\n  watch(viewmodel, _ = type(viewmodel, ViewModel)) {\n    viewmodel.addListener(this);\n    this.render(viewmodel);\n  }\n\n  unwatch(viewmodel, _ = type(viewmodel, ViewModel)) {\n    viewmodel.removeListener(this);\n  }\n\n  render(viewmodel, _ = type(viewmodel, ViewModel)) {\n    const processores = Object.entries(this.#processors);\n    this.#items.forEach(item => {\n      const vm = type(viewmodel[item.viewmodel], ViewModel), el = item.el;\n      processores.forEach(([pk, processor]) => {\n        Object.entries(vm[pk]).forEach(([k, v]) => {\n          processor.process(vm, el, k, v);\n        });\n      });\n    });\n  }\n};\nconst BinderItem = class {\n  el;\n  viewmodel;\n\n  constructor(el, viewmodel, _0 = type(el, HTMLElement), _1 = type(viewmodel, 'string')) {\n    this.el = el;\n    this.viewmodel = viewmodel;\n    Object.freeze(this);\n  }\n};\nconst scanner = new Scanner;\nconst binder = scanner.scan(document.querySelector('#target'));\nbinder.addProcessor(new (class extends Processor {\n  _process(vm, el, k, v) {\n    el.style[k] = v;\n  }\n})('styles'));\nbinder.addProcessor(new (class extends Processor {\n  _process(vm, el, k, v) {\n    el.setAttribute(k, v);\n  }\n})('attributes'));\nbinder.addProcessor(new (class extends Processor {\n  _process(vm, el, k, v) {\n    el[k] = v;\n  }\n})('properties'));\nbinder.addProcessor(new (class extends Processor {\n  _process(vm, el, k, v) {\n    console.log('event', k, v, el);\n    el['on' + k] = e => v.call(el, e, vm);\n  }\n})('events'));\nconst viewmodel = ViewModel.get({\n  isStop: false,\n  changeContents() {\n    this.wrapper.styles.background = `rgb(${parseInt(Math.random() * 150) + 100},${parseInt(Math.random() * 150) + 100},${parseInt(Math.random() * 150) + 100})`;\n    this.contents.properties.innerHTML = Math.random().toString(16).replace('.', '');\n  },\n  wrapper: ViewModel.get({\n    styles: {\n      width: '50%',\n      background: '#ffa',\n      cursor: 'pointer',\n    },\n    events: {\n      click(e, vm) {\n        vm.parent.isStop = true;\n        console.log('click', vm);\n      },\n    },\n  }),\n  title: ViewModel.get({\n    properties: {\n      innerHTML: 'Title',\n    },\n  }),\n  contents: ViewModel.get({\n    properties: {\n      innerHTML: 'Contents',\n    },\n  }),\n});\nbinder.watch(viewmodel);\nconst f = _ => {\n  viewmodel.changeContents();\n  if (!viewmodel.isStop) requestAnimationFrame(f);\n};\nrequestAnimationFrame(f);\n")))," "),Object(i.b)("hr",null),Object(i.b)("h2",{id:"1-\uae30\uc874-binder-\uc758-viewmodelupdated-\uc758-\ubb38\uc81c"},"1. \uae30\uc874 Binder \uc758 viewmodelUpdated \uc758 \ubb38\uc81c"),Object(i.b)("p",null,"viewmodel \uc740 client \ucf54\ub4dc\uc5d0\uc11c \uc0dd\uc131\ud55c \uc804\uc5ed\ubcc0\uc218(\uc804\uc5ed\uac1d\uccb4)"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript",metastring:"{3,7}","{3,7}":!0},"const Binder = class extends ViewModelListener {\n  // ...\n  viewmodelUpdated(updated) {\n    const items = {};\n    this.#items.forEach(item => {\n      items[item.viewmodel] = [\n        type(viewmodel[item.viewmodel], ViewModel),\n        item.el,\n      ];\n    });\n    updated.forEach(v => {\n      if (!items[v.subKey]) return;\n      const [vm, el] = items[v.subKey], processor = this.#processors[v.cat];\n      if (!el || !processor) return;\n      processor.process(vm, el, v.k, v.v);\n    });\n  }\n}\n")),Object(i.b)("p",null,"viewmodelUpdated\uc5d0\uc11c viewmodel\uc744 \uc778\uc790\ub85c \ubc1b\uc544\uc624\ub3c4\ub85d \ud55c\ub2e4."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript",metastring:"{2,6,9}","{2,6,9}":!0},"const ViewModelListener = class extends {\n  viewmodelUpdated (viewmodel, updated) { throw 'override!' }\n}\n\nconst Binder = class extends ViewModelListener {\n  viewmodelUpdated (viewmodel, updated) {\n    const items = {}\n    this.#items.forEach(({ vmName, el }) => {\n      items[vmName] = [type(viewdmoel[vmName], ViewModel), el]\n    })\n    // ...\n  }\n}\n")),Object(i.b)("p",null,"ViewModel\uc5d0\uc11c notify\ub85c Binder \uc5d0\uac8c \ucd5c\uc2e0 \uc815\ubcf4\ub97c \ubcf4\ub0b4\uac8c \ub41c\ub2e4. \uc774 \ucf54\ub4dc \ub610\ud55c \uc218\uc815\ud574\uc57c \ud55c\ub2e4\n",Object(i.b)("img",{parentName:"p",src:"https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuKhEpyb9JIx9pCyhLWZBJ2ttpKz9pU7Aooz9LSWlIor2Y2bOAPG1sRaWTcX1Ic99QWeNGbBNJi4fCoy5gC5AGKiBg3qphL9B2yaSk2o68L0Pe0aWuu0gWb910fbvwLmEG1RGaG00",alt:null})),Object(i.b)("p",null,"viewModel \uc5d0\uc11c \uc2e4\ud589\ud55c viewmodelUpdated \ub294 viewmodel \uc778\uc790\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294\ub2e4."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"const ViewModel = class extends ViewModelListener {\n  notify () { this.#listeners.forEach(v => v.viewmodelUpdated(this, this.#isUpdated)) }\n  viewmodelUpdated (viewmodel, updated) { updated.forEach(v => this.#isUpdated.add(v)) }\n}\n")),Object(i.b)("p",null,"Binder viewmodelUpdated \uc758 viewmodel \uc778\uc790\ub294 ViewModelSubject \uc774\uac70\ub098 ViewModel \uc774\ub2e4.",Object(i.b)("br",{parentName:"p"}),"\n","\u2192 \uc778\uc790\uac00 ViewModel \uc774 \ub418\ub3c4\ub85d \ub9cc\ub4e4\uc790."),Object(i.b)("p",null,"ViewModelSubject \ub294 Binder \uc5d0\uac8c \ub118\uae30\ub294 Parameter(viewmodel)\ub97c ViewModel \uc5d0\uac8c \uc704\uc784\ud55c\ub2e4."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"const ViewModelSubject = class extends ViewModelListener {\n  notify () { \n    this.#listeners.forEach(v => v.viewmodelUpdated(this.notifyTarget, this.#info)) \n  }\n  get notifyTarget () { throw 'must be override!' } // ViewModel\uc5d0\uac8c \uc704\uc784\ud55c\ub2e4.\n}\n\nconst ViewModel = class extends ViewModelSubject {\n  get notifyTarget () { return this } // notifyTarget \uc744 \ud638\ucd9c\ud558\uba74 ViewModel\uc744 \ubcf4\ub0b8\ub2e4.\n}\n")),Object(i.b)("p",null,"Binder \ub294 \ub2e4\uc74c\uacfc \uac19\uc774 \ubcc0\uacbd\ub41c\ub2e4."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript",metastring:"{3}","{3}":!0},"const Binder = class extends ViewModelListener {\n  viewmodelUpdated(target, updated,\n                   _ = type(target, ViewModel)){ // target\uc740 ViewModel \uc774\uc5ec\uc57c \ud55c\ub2e4.\n    const items = {}\n    this.#items.forEach(({ vmName, el }) => {\n      items[vmName] = [type(target[vmName], ViewModel), el]\n    })\n    // ...\n  }\n}\n")),Object(i.b)("p",null,"Binder \uac00 \ubc1b\uc544\ub4e4\uc774\ub294 viewmodel(target)\uc740 ViewModelSubject \uac00 \uc544\ub2c8\ub77c ViewModel \uc774\uc5ec\uc57c \ud55c\ub2e4."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"\ucd94\uc0c1 \uacc4\uce35\uc744 \ubd84\ub9ac\ud558\uac8c \ub420 \uacbd\uc6b0, \uc5b4\ub5a0\ud55c \ubb38\uc81c\uac00 \uc0dd\uacbc\uc744 \ub54c \uac01\uac01\uc758 \uacc4\uce35\uc5d0\uc11c \ud574\uacb0\ud558\ub3c4\ub85d \ub9cc\ub4dc\ub294 \uac83\uc744 \uc9c0\ud5a5\ud574\uc57c \ud55c\ub2e4.")),Object(i.b)("h2",{id:"2-processor-\uac1c\uc120"},"2. Processor \uac1c\uc120"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"\ucc98\ub9ac\uae30(Processor)\ub294 \ub370\uc774\ud130 \uad6c\uc870(ViewModel)\uacfc \ub3d9\uae30\ud654 \ub418\uc5b4\uc57c \ud55c\ub2e4."),"  "),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Processor \ub294 \ud655\uc7a5 \uac00\ub2a5 \ud558\ub3c4\ub85d \ub9cc\ub4e4\uc5c8\ub2e4."),Object(i.b)("li",{parentName:"ul"},"\uadf8\ub7ec\ub098, ViewModel \uc5d0\uc11c Processor \uc758 \uc885\ub958\ub97c style attributes properties \ub4f1\uc73c\ub85c \uc81c\ud55c \ud558\uace0 \uc788\ub2e4"),Object(i.b)("li",{parentName:"ul"},"\uc989, ",Object(i.b)("em",{parentName:"li"},"ViewModel \uc774 Processor\uc758 \ud655\uc7a5\uc744 \uc81c\ud55c"),"\ud558\uace0 \uc788\ub294 \uac83\uc774\ub2e4. \uadf8\ub798\uc11c \uc774 \ubd80\ubd84\uc744 \uc798 \ud655\uc7a5\ub418\ub3c4\ub85d \uc77c\ubc18\ud654 \uc2dc\ucf1c\uc57c \ud55c\ub2e4."),Object(i.b)("li",{parentName:"ul"},"\ub370\uc774\ud130 \uad6c\uc870\ub97c \ub3d9\uc801\uc73c\ub85c \ubc14\uafc0 \uc218 \uc788\uac8c \ud55c\ub2e4. ")),Object(i.b)("details",null,Object(i.b)("summary",null,"Before"),Object(i.b)("p",null,Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript",metastring:"{9}","{9}":!0},"const Binder = class extends ViewModelListener {\n  // ... \uc0dd\ub7b5\n  render (viewmodel, _ = type(viewmodel, ViewModel)) {\n    const processores = Object.entries(this.#processors)\n    this.#items.forEach(({ vmName, el }) => {\n      const vm = type(viewmodel[vmName], ViewModel)\n      processores.forEach(([pk, processor]) => {\n        Object.entries(vm[pk]).forEach(([k, v]) => {\n          processor.process(vm, el, k, v)\n        })\n      })\n    })\n  }\n}\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript",metastring:"{6}","{6}":!0},"const ViewModel = class extends ViewModelSubject {\n  // ... \uc0dd\ub7b5\n  constructor(data, _ = type(data, 'object')) {\n    super();\n    Object.entries(data).forEach(([k, v]) => {\n      if('styles,attributes,properties'.includes(k)) {\n        if(!v || typeof v != 'object') throw `invalid object k: ${k}, v:${v}`\n        // ...\n      } else {\n        Object.defineProperty(this, k, ViewModel.descriptor(this, '', k, v))\n        if (v instanceof ViewModel) {\n          v._setParent(this, k)\n        }\n      }\n    })\n    Object.seal(this)\n  }\n}\n")),Object(i.b)("p",null,"Client \ucf54\ub4dc"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript",metastring:"{2,5,8,11}","{2,5,8,11}":!0},"binder.addProcessor(new class extends Processor {\n  _process (vm, el, k, v) { el.style[k] = v }\n}('styles'))\nbinder.addProcessor(new class extends Processor {\n  _process (vm, el, k, v) { el.setAttribute(k, v) }\n}('attributes'))\nbinder.addProcessor(new class extends Processor {\n  _process (vm, el, k, v) { el[k] = v }\n}('properties'))\nbinder.addProcessor(new class extends Processor {\n  _process (vm, el, k, v) { el[`on${k}`] = e => v.call(el, e, vm) }\n}('events'))\n")))),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Processor\uc758 Spec\uc774 Code\ub85c \uc815\uc758 \ub41c \uc0c1\ud0dc\ub2e4"),Object(i.b)("br",{parentName:"p"}),"\n","\u2192 code \ub97c \uc77d\uc9c0 \uc54a\uc73c\uba74 \ub370\uc774\ud130 \ud615\uc2dd\uc744 \uc62c\ubc14\ub974\uac8c \uc791\uc131\ud560 \uc218 \uc5c6\uac8c \ub41c\ub2e4."),Object(i.b)("p",null,"\uc790\uc720\ub86d\uac8c \ub370\uc774\ud130\ub97c \uae30\uc220\ud560 \uc218 \uc788\uac8c \ub9cc\ub4dc\ub294 \ubc29\ubc95"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\uc9c0\uae08\uae4c\uc9c0\uc758 viewModel \ud30c\uc11c\ub294 ",Object(i.b)("em",{parentName:"li"},"\uc5c4\uaca9\ud55c \ud615\uc2dd\uc744 \uac16\uace0 \uc788\ub294 \ud30c\uc11c"),"\uc774\ub2e4."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("em",{parentName:"li"},"\uc790\uc720\ub85c\uc6b4 Parser"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Object \uac00 \ub4e4\uc5b4\uc624\uba74 Object \uc758 \ud2b8\ub9ac\ub97c \ub9c8\uc74c\ub300\ub85c \ud0d0\uc0c9\ud558\uba74\uc11c Object \uc758 \ud0a4\uc640 \uac12\ub4e4\uc744 getter setter \ub85c \ubc14\uafd4\uc8fc\uace0\n\ubc30\uc5f4\uc758 \uc6d0\uc18c\ub4e4\uc744 getter setter \ub85c \ubc14\uafd4\uc8fc\uc5b4\uc57c \ud55c\ub2e4."),Object(i.b)("li",{parentName:"ul"},"\uc989. \uc5b4\ub5a4 \ud615\uc2dd\uc774\ub4e0 \uc548\uc815\uc801\uc73c\ub85c Observer \ud328\ud134\uc774 \uc798 \uc801\uc6a9\ub418\ub294 Getter \uc640 Setter \ub85c \ub9cc\ub4dc\ub294 Parser \ub97c \ub9cc\ub4e4\uc5b4\uc57c \ud55c\ub2e4.")))),Object(i.b)("p",null,"\uae30\uc874 viewModel \uc758 constructor \ub294 viewModel \uc758 \uad6c\uc870\ub97c \uc5c4\uaca9\ud788 \uc81c\ud55c\ud558\ub294 \ud30c\uc11c\uc758 \uae30\ub2a5\uc744 \ud558\uace0 \uc788\uc5c8\ub2e4.",Object(i.b)("br",{parentName:"p"}),"\n","\uc774 \uae30\ub2a5\uc744 define \uba54\uc11c\ub4dc\uc5d0\uac8c \uc704\uc784\uc744 \ud560 \uac83\uc774\ub2e4. "),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"const ViewModel = class extends ViewModelSubject {\n  static KEY = Symbol()\n\n  constructor(data, _ = type(data, 'object')) {\n    super();\n    this[ViewMode.KEY] = 'root';\n    Object.entries(data).forEach(([k, v]) => this.define(this, k, v));\n    Object.seal(this);\n  }\n\n  // \ubaa8\ub4e0 Key\ub97c Observer\uc5d0\uac8c \ubcf4\uace0\ud55c\ub2e4.\n  define(target, k, v) {\n    // ViewModel \uc740 \uc0dd\uc131\ud558\uc9c0 \uc54a\uc544\ub3c4 \uc774\ubbf8 \uc0dd\uc131\uc790\uc5d0\uc11c \uc2a4\uce94\ud588\uae30 \ub54c\ubb38\uc5d0 ? \uc2a4\uce94\ud558\uc9c0 \uc54a\ub294\ub2e4. \n    if (v && typeof v == 'object' && !(v instanceof ViewModel)) {\n      if (v instanceof Array) {\n        target[k] = []\n        // \uc0c1\ub300\uc801\uc778 \uacbd\ub85c \ud45c\uae30. key\uc758 \ud655\uc7a5 -> \ud0a4\ub85c\ubd80\ud130 \uce74\ud14c\uace0\ub9ac\ub97c \uc54c \uc218 \uc788\uac8c \ub41c\ub2e4.\n        target[k][ViewModel.KEY] = target[ViewModel.KEY] + '.' + k \n        // \uc7ac\uadc0\n        v.forEach((v, i) => this.define(target[k], i, v))\n      } else {\n        target[k] = { [ViewModel.KEY]: target[ViewModel.KEY] + '.' + k } \n        Object.entries(v).forEach(([ik, iv]) => this.define(target[k], ik, iv))\n      }\n      Object.defineProperty(target[k], 'subKey', {\n        get: () => target.subKey\n      })\n    } else {\n      // \uc7ac\uadc0 \ud568\uc218\ub294 \uc7ac\uadc0\uac00 \ub05d\ub098\ub294 \uc870\uac74\uc744 \uba85\ud655\ud558\uac8c \uc54c\uba74 \ub41c\ub2e4.\n      // \uc885\uacb0 \uc870\uac74\uc744 \ubc18\ub4dc\uc2dc \ub9cc\ub4e4\uc5b4\uc57c \ud55c\ub2e4.\n      if (v instanceof ViewModel) v._setParent(this, k)\n      Object.defineProperties(target, {\n        [k]: {\n          enumerable: true,\n          get: _ => v,\n          set: newV => {\n            v = newV\n            // \ud0a4\ub85c\ubd80\ud130 \uce74\ud14c\uace0\ub9ac\ub97c \uc54c \uc218 \uc788\uac8c \ub41c\ub2e4.\n            this.add(new ViewModelValue(target.subKey, target[ViewModel.KEY], k, v))\n          }\n        }\n      })\n    }\n  }\n}\n")),Object(i.b)("p",null,"\uc544\ubb34 \uac1d\uccb4\ub098 observe \uac00 \ub418\ub294 viewModel \ub85c \ubc14\ub00c\uc5c8\ub2e4. "),Object(i.b)("p",null,"Binder \uc5d0\uc11c Processor \ub97c \uac00\uc838\uc62c \ub54c Category \ub97c \uc2dd\ubcc4\ud558\ub294 \ub85c\uc9c1\uc774 \ud544\uc694"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"const Binder = class extends ViewModelListener {\n  viewmodelUpdated (updated) {\n    const items = {}\n    this.#items.forEach(({ vmName, el }) => {\n      items[vmName] = [type(rootViewModel[vmName], ViewModel), el]\n    })\n    updated.forEach(({ subKey, category, k, v }) => {\n      if (!items[subKey]) return\n      // (category)\ud0a4 \uacbd\ub85c\uc758 \ub9c8\uc9c0\ub9c9 \uac83\uc744 \uac00\uc838\uc628\ub2e4. \n      const [vm, el] = items[subKey], processor = this.#processors[category.split('.').pop()]\n      if (!el || !processor) return\n      processor.process(vm, el, k, v)\n    })\n  }}\n")),Object(i.b)("p",null,"Processor \uc138\ud2b8\ub97c \ub9e4 \ubc88 \ub9cc\ub4e4\uc9c0 \uc54a\uace0 \ubbf8\ub9ac \ub9cc\ub4e4\uc5b4 \ub450\uc790."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"const SetDomProcessor = (() => {\n  const visitor = new DomVisitor\n  const scanner = new DomScanner(visitor)\n  // Process\uac00 \ub2e8\uc21c\ud55c \uc774\uc720\ub294 Binder\uac00 \ubb34\uac70\uc6cc\uc84c\uae30 \ub54c\ubb38\n  // \uc774\uc5d0 \ub300\ud55c \uc758\uc0ac\uacb0\uc815\uc740 \uc870\uc9c1\uc5d0 \ub530\ub77c \ub2ec\ub77c\uc9d0\n  const baseProcessors = [\n    new class extends Processor {\n      _process (vm, el, k, v) { el.style[k] = v } \n    }('styles'),\n    new class extends Processor {\n      _process (vm, el, k, v) { el.setAttribute(k, v) }\n    }('attributes'),\n    new class extends Processor {\n      _process (vm, el, k, v) { el[k] = v }\n    }('properties'),\n    new class extends Processor {\n      _process (vm, el, k, v) { el[`on${k}`] = e => v.call(el, e, vm) }\n    }('events')\n  ]\n  const setProcessor = () => {\n    const binder = type(scanner.scan(document.body), Binder)\n    baseProcessors.forEach(v => binder.addProcessor(v))\n  }\n})();\nconst binder = SetDomProcessor();\n")),Object(i.b)("p",null,"\ub2e4\uc74c\uc740 Binder \uc640 \ubb34\uad00\ud55c Processor Set \uc744 \ub9cc\ub4e4 \uc218 \uc788\ub2e4."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript",metastring:"{2}","{2}":!0},"const Binder = class extends ViewModelListener {\n  #items = new Set; #processor = null;\n\n  set processor(v) {\n    this.#processor = v;\n  }\n\n  render(viewmodel, _ = type(viewmodel, ViewModel)) {\n    const processors = Object.entries(this.#processors);\n    this.#items.forEach(item => {\n      const vm = type(viewmodel[item.viewmodel], ViewModel), el = item.el;\n      if (this.#processors?.cat = pk)   // pk ??\n        process(vm[pk], el, k, v);\n    });\n  }\n}\n")),Object(i.b)("p",null,"Processor \ub97c LinkedList \ub85c \ubc14\uafb8\uc5c8\ub2e4."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},'const Processor = class {\n  cat; #next = null;\n  constructor(cat) {\n    this.cat = cat;\n    Object.freeze(this);\n  }\n  next(process) {\n    this.#next = process;\n    return process;\n  }\n  \n  process(vm, el, k, v, _0 = type(vm, ViewModel), _1 = type(el, HTMLElement), _2 = type(k, "string")) {\n    this._process(vm, el, k, v);\n    if (this.#next) this.#next.process(vm, el, k, v);\n  }\n\n  _process(vm, el, k, v) { throw "override"; }\n}\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},'const p1 = new (class extends Processor {\n  _process(vm, el, k, v) {\n    el.style[k] = v;\n  }\n})("styles");\n\np1.next(new (class extends Processor{\n  _process(vm, el, k, v) { el.setAttribute(k, v); }\n})("attributes"))\n.(next(...))\n.(next(...))\n;\n// ...\n\n// LinkedList \uc758 head \ub9cc set \ud558\uc600\ub2e4.\nbinder.processor = p1;\n')),Object(i.b)("p",null,"\uc77c\ubc18\uc801\uc73c\ub85c \uac1d\uccb4\uc548\uc5d0 collection \uc774 \uc788\uc73c\uba74 \uc704\ud5d8\ud55c \ucc45\uc784\uc774\ub2e4.",Object(i.b)("br",{parentName:"p"}),"\n","\uc77c\ubc18\ud654\ub97c \uae68\ub294 \uc8fc\uc694 \uc6d0\uc778\uc740 collection \ub8e8\ud504\uc77c \uc218 \uc788\ub2e4.",Object(i.b)("br",{parentName:"p"}),"\n","collection \ub97c \uac16\uace0 \uc788\ub294 \uac83\uc774 \ub8e8\ud504\ub97c \ub3cc\uba74 \uc815\ucc45\uc774 \ub2e4\uc591\ud560 \uc218\uac00 \uc5c6\ub2e4.  "),Object(i.b)("p",null,"Processor \ub85c \uc704\uc784\uc744 \ud55c\ub2e4\uba74, process \uc758 \ub2e4\uc591\ud55c \uc815\ucc45\uc744 \uc2e4\ud604\ud560 \uc218 \uc788\ub2e4."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},"process(...) {\n  if (this.#next && this.isOk && vm... && ... Condition ) ...\n}\n")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"#items")," \ub294 \uac12 \uac1d\uccb4\uc774\uace0, \ud589\uc704\uac00 forEach (\uac00\ub2a5\uc131) \ubc16\uc5d0 \uc5c6\uae30 \ub54c\ubb38\uc5d0 \uc548\uc804\ud558\ub2e4.",Object(i.b)("br",{parentName:"p"}),"\n","\ubc18\uba74\uc5d0 processor \ub294 \ud589\uc704\ub97c \uac16\uace0 \uc788\ub294 \uac1d\uccb4\uc774\uace0, \uc548\uc804\ud558\uc9c0 \uc54a\ub2e4."),Object(i.b)("p",null,"\ub514\uc790\uc778\uc758 \uc815\ub2f5\uc774 \uc5c6\ub294 \uc774\uc720\ub294, \uadf8 \uc0ac\ub78c, \uc870\uc9c1\uc5d0\uac8c \ub9de\ub0d0 \uc548\ub9de\ub0d0\uac00 \uc911\uc694\ud558\ub2e4.",Object(i.b)("br",{parentName:"p"}),"\n","\uc5b4\ub824\uc6b4 \ubd80\ubd84\uc774 \uc0dd\uae30\uba74 \uc26c\uc6b4 \ubd80\ubd84\uc774 \uc0dd\uae30\uae30 \ub9c8\ub828\uc774\ub2e4."),Object(i.b)("p",null,"\uc131\uae09\ud55c \uc77c\ubc18\ud654\ub294 \uc548\ub41c\ub2e4.",Object(i.b)("br",{parentName:"p"}),"\n","\uc11c\ube44\uc2a4\uac00 \ub9e4\uc77c \ubc14\ub010\ub2e4\uba74 \ucf54\uc5b4\ub97c \uac00\ubccd\uac8c \ub9cc\ub4e0\ub2e4.",Object(i.b)("br",{parentName:"p"}),"\n","\uc548\uc815\uc801\uc778 \uc11c\ube44\uc2a4\ub294 \ucf54\uc5b4\ub97c \ubb34\uac81\uac8c \ub9cc\ub4e4\uc5b4 \uc81c\uc5b4\uc758 \uc5ed\uc804\uc744 \ud55c\ub2e4. "),Object(i.b)("h2",{id:"3-list-\ud45c\ud604\ud558\uae30"},"3. List \ud45c\ud604\ud558\uae30"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-html"},'<body>\n<section id="target" data-viewmodel="wrapper">\n  <h2 data-viewmodel="title"></h2>\n  <section data-viewmodel="contents"></section>\n  <ol data-viewmodel="list">\n    <li data-template="listItem" data-viewmodel="item"></li>\n  </ol>\n</section>\n</body>\n')),Object(i.b)("p",null,"DomScanner \uc5d0 f \ud568\uc218 \ubd80\ubd84\uc774 \ubc14\ub00c\uc5c8\ub2e4."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript",metastring:"{9}","{9}":!0},'const DomScanner = class extends Scanner {\n  static #template = new Map;\n  static get(k) { return this.#templates.get(k); }\n  constructor(visitor, _=type(visitor, DomVisitor)) {\n    super(visitor);\n  }\n  scan(target, _ = type(target, HTMLElement)) {\n    const binder = new Binder, f = el => {\n      const template = el.getAttribute("data-template");\n      if (template) {\n        el.removeAttribute("data-template");\n        DomScanner.#templates.set(template, el);\n        // \ud15c\ud50c\ub9bf\uc740 \uc9c4\uc9dc \uc6d0\uc18c\uac00 \uc544\ub2c8\ubbc0\ub85c \ubd80\ubaa8\uc5d0\uc11c \uc81c\uac70\ud55c\ub2e4.\n        el.parentElement?.removeChild(el);\n      } else {\n        const vm = el.getAttribute("data-viewmodel");\n        if (vm) {\n          el.removeAttribute(\'data-viewmodel\');       \n          binder.aadd(new BinderItem(el, vm));  \n        }\n      }\n      f(target);\n      this.visit(f, target);\n      return binder;\n    }\n  }\n}\n')),Object(i.b)("p",null,"\uc0c8\ub85c\uc6b4 template processor \ub97c \ucd94\uac00\ud558\uc600\ub2e4. viewModel \uc758 template \uc774\ub77c\ub294 key \uc5d0 \ubc18\uc751\ud560 \uac83\uc774\ub2e4. "),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},'new (class extends Processor {\n  _process(vm, el, k, v) {\n    const { name = err("no name"), data = err("no data")} = vm.template;\n    const template = DomScanner.get(name) || err("no template:" + name);\n    if (!(data instanceof Array)) err("invalid data: " + data);\n\n    /* (*) move To\n    data.forEach((vm, i) => {\n      // \ud074\ub80c\uc9d5 \ucf54\ub4dc\uc640 \ub85c\uc9c1\uc774 \uc11e\uc5ec\uc788\ub294 \ub098\uc05c \ucf54\ub4dc \n      if (!(vm instanceof ViewModel)) err(`invalid Viewmodel: ${i} - ${vm}`);\n    });\n    */\n\n    // BLACKLIST -- Shield Pattern\n    // ------------------- \n    // WHITELIST\n    // \uac80\uc99d\ub41c \ub370\uc774\ud130\ub97c \uc0ac\uc6a9\ud558\uc790 *****\n    // const WL = { template, data };\n    Object.freeze(data);\n    visitor.visit(el => {\n      if (el.binder) {\n        const [binder, vm] = el.binder;\n        binder.unwatch(vm);\n        delete el.binder;\n      }\n    }, el);\n    el.innerHTML = \'\';\n    data.forEach((vm, i) => {\n      // \ud074\ub80c\uc9d5 \ucf54\ub4dc\uc640 \ub85c\uc9c1\uc774 \uc11e\uc5ec\uc788\ub294 \ub098\uc05c \ucf54\ub4dc, \uc8fc\uc11d (*) move To \uc73c\ub85c \uc774\ub3d9\ud574\uc57c \ud55c\ub2e4. \n      // \uc774 \uc904\uacfc WHILTELIST \ucf54\ub4dc \uc0ac\uc774\uc5d0 data \ub97c \uc4f0\ub294 \ucf54\ub4dc\uac00 \ub098\uc624\uba74 \ubc84\uadf8\uac00 \uc0dd\uae38 \uc218 \uc788\ub2e4. \n      // \ub85c\uc9c1 \ucf54\ub4dc\uac00 \uc2dc\uc791\ub418\uae30 \uc804\uc5d0 \uac80\uc99d\uc774 \ub05d\ub098\uc57c \ud55c\ub2e4.\n      if (!(vm instanceof ViewModel)) err(`invalid Viewmodel: ${i} - ${vm}`);\n      const child = template.cloneNode(true);\n      const binder = setProcessor(scanner.scan(child));\n      el.binders = [binder, vm];\n      binder.watch(vm);\n      el.appendChild(child);\n    });\n  }\n})("template")\n')),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-javascript"},'const viewmodel = ViewModel.get({\n    isStop:false,\n    changeContents(){\n        this.wrapper.styles.background = `rgb(${parseInt(Math.random()*150) + 100},${parseInt(Math.random()*150) + 100},${parseInt(Math.random()*150) + 100})`;\n        this.contents.properties.innerHTML = Math.random().toString(16).replace(".", "");\n        this.list.template.data.forEach(({item:{styles, properties}})=>{\n            properties.innerHTML = Math.random().toString(16).replace(".", "");\n            styles.background = `rgb(${parseInt(Math.random()*150) + 100},${parseInt(Math.random()*150) + 100},${parseInt(Math.random()*150) + 100})`;\n        });\n    },\n    // ...\n    list:ViewModel.get({\n        template:{\n            name:"listItem",\n            data:"1,2,3,4,5,6".split(",").map(v=>ViewModel.get({\n                item:ViewModel.get({\n                    styles:{background:"#fff"},\n                    properties:{innerHTML:"item " + v}\n                })\n            }))\n        }\n    })\n});\n')))}d.isMDXComponent=!0},470:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return v}));var r=t(0),s=t.n(r);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,s=function(e,n){if(null==e)return{};var t,r,s={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var c=s.a.createContext({}),d=function(e){var n=s.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=d(e.components);return s.a.createElement(c.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return s.a.createElement(s.a.Fragment,{},n)}},b=s.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,a=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(t),b=r,v=p["".concat(a,".").concat(b)]||p[b]||m[b]||i;return t?s.a.createElement(v,o(o({ref:n},c),{},{components:t})):s.a.createElement(v,o({ref:n},c))}));function v(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,a=new Array(i);a[0]=b;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,a[1]=o;for(var c=2;c<i;c++)a[c]=t[c];return s.a.createElement.apply(null,a)}return s.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);